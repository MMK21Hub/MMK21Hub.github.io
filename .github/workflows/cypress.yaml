name: Cypress tests
on: [push]
jobs:
  cypress-run:
    name: Cypress
    runs-on: ubuntu-20.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        
      - name: Start Dev Server
        run: npm i && (npm run start:stream&)

      - name: Run Cypress
        uses: cypress-io/github-action@v2
        with:
          record: true
          env: CYPRESS_RECORD_KEY=${{ secrets.CYPRESS_RECORD_KEY }},GITHUB_TOKEN=${{ secrets.GITHUB_TOKEN }}
          wait-on: "http://localhost:8080"
        env:
          # pass the Dashboard record key as an environment variable
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
          # pass GitHub token to allow accurately detecting a build vs a re-run build
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Debug
        run: "curl http://localhost:8080"
